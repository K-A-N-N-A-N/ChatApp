<!DOCTYPE html>
<html>
<head>
    <title>Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        body {
            font-family: Arial;
            max-width: 600px;
            margin: auto;
        }
        #header {
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ccc;
        }
        #chat {
            border: 1px solid #ccc;
            height: 350px;
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 10px;
            background: #fafafa;
        }
        .me {
            font-weight: bold;
        }
        .other {
            font-weight: normal;
        }
    </style>
</head>
<body>

<div id="header"></div>

<div id="chat"></div>

<input id="message" placeholder="Type message..." style="width: 80%;" />
<button onclick="send()">Send</button>

<script>
    const params = new URLSearchParams(window.location.search);
    const userId = params.get("userId");
    const username = params.get("username"); // ðŸ‘ˆ pass this in URL
    const chatRoomId = params.get("chatRoomId");

    if (!userId || !username || !chatRoomId) {
        alert("Missing userId / username / chatRoomId");
        throw new Error("Missing params");
    }

    // Header (no room id shown)
    document.getElementById("header").innerHTML = `
        <b>Connected as:</b> ${username}<br/>
        <b>Private Chat</b>
    `;

    const socket = new WebSocket(
        "ws://localhost:8080/ws?userId=" + userId + "&chatRoomId=" + chatRoomId
    );

    const stompClient = Stomp.over(socket);

    stompClient.connect({}, () => {
        console.log("âœ… Connected");

        stompClient.subscribe("/topic/chatroom/" + chatRoomId, (msg) => {
            const body = JSON.parse(msg.body);

            const isMe = body.senderId === userId;
            const senderLabel = isMe ? "You" : body.senderUsername;
            const cssClass = isMe ? "me" : "other";

            document.getElementById("chat").innerHTML +=
                `<p class="${cssClass}">${senderLabel}: ${body.content}</p>`;

            // auto-scroll
            const chatDiv = document.getElementById("chat");
            chatDiv.scrollTop = chatDiv.scrollHeight;
        });
    });

    function send() {
        const input = document.getElementById("message");
        if (!input.value.trim()) return;

        stompClient.send(
            "/app/chat.send",
            {},
            JSON.stringify({ content: input.value })
        );

        input.value = "";
    }
</script>

</body>
</html>
